<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="Style.css" />
    <script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
    <script src="eel.js"></script>
  </head>

  <body onload="get_data_rob()">
    <a href="index.html" id="back">âžœ</a>
    <div id="wrapper">
      <p class="comp-table-heading">BERT Searches</p>
      <table ind="1" id="data-table" class="sortable">
        <thead>
          <tr id="table-header-row">
            <th>Search Term</th>
            <th>Platform</th>
            <th>Date</th>
            <th>Time</th>
            <th>View Report</th>
            <th>Delete Search</th>
          </tr>
        </thead>
        <tbody id="data-body"></tbody>
      </table>
    </div>

    <div id="wrapper">
      <p class="comp-table-heading">VADER Searches</p>
      <table ind="2" id="data-table" class="sortable">
        <thead>
          <tr id="table-header-row">
            <th>Search Term</th>
            <th>Platform</th>
            <th>Date</th>
            <th>Time</th>
            <th>View Report</th>
            <th>Delete Search</th>
          </tr>
        </thead>

        <tbody id="data-body2"></tbody>
      </table>
    </div>
  </body>

  <script>
    async function get_row_rob(x) {
      index = x.parentNode.parentNode.rowIndex;
      console.log(index);
      table = document.querySelectorAll('table[ind="1"]')[0];
      console.log(table);
      row = table.getElementsByTagName("tr")[index];
      console.log(
        row.cells[0].innerHTML,
        row.cells[1].textContent,
        row.cells[2].innerHTML,
        row.cells[3].innerHTML
      );
      await eel.apply_view_data_rob(
        row.cells[0].innerHTML,
        row.cells[1].textContent,
        row.cells[2].innerHTML,
        row.cells[3].innerHTML
      )();
      window.location.href = "roberta_summary_view.html";
    }

    async function delete_row_rob(x) {
      index = x.parentNode.parentNode.rowIndex;
      table = document.querySelectorAll('table[ind="1"]')[0];
      row = table.getElementsByTagName("tr")[index];
      if (confirm("Are you sure?")) {
        await eel.delete_row(
          row.cells[0].innerHTML,
          row.cells[1].textContent,
          row.cells[2].innerHTML,
          row.cells[3].innerHTML,
          "rob"
        )();
        window.location.reload();
      }
    }

    async function get_row_vad(x) {
      index = x.parentNode.parentNode.rowIndex;
      console.log(index);
      table = document.querySelectorAll('table[ind="2"]')[0];
      console.log(table);
      row = table.getElementsByTagName("tr")[index];
      console.log(
        row.cells[0].innerHTML,
        row.cells[1].textContent,
        row.cells[2].innerHTML,
        row.cells[3].innerHTML
      );
      await eel.apply_view_data_vad(
        row.cells[0].innerHTML,
        row.cells[1].textContent,
        row.cells[2].innerHTML,
        row.cells[3].innerHTML
      )();
      window.location.href = "vader_summary_view.html";
    }

    async function delete_row_vad(x) {
      index = x.parentNode.parentNode.rowIndex;
      table = document.querySelectorAll('table[ind="2"]')[0];
      row = table.getElementsByTagName("tr")[index];
      if (confirm("Are you sure?")) {
        await eel.delete_row(
          row.cells[0].innerHTML,
          row.cells[1].textContent,
          row.cells[2].innerHTML,
          row.cells[3].innerHTML,
          "vad"
        )();
        window.location.reload();
      }
    }
    async function get_data_rob() {
      data = await eel.get_files()();
      table_body = document.getElementById("data-body");

      for (const key of data[0]) {
        file = key.split(",");
        row = document.createElement("tr");
        table_body.appendChild(row);

        for (let i = 0; i < file.length + 2; i++) {
          info = document.createElement("td");
          if (i == 3) {
            info.innerHTML = `${file[i].slice(0, -4).replaceAll(".", ":")}`;
          } else if (i == 2) {
            info.innerHTML = `${file[i].replaceAll(".", "/")}`;
          } else if (i == 5) {
            info.innerHTML = `<button class = "del-btn" onclick="delete_row_rob(this)">DELETE</button>`;
          } else if (i == 4) {
            info.innerHTML = `<button class = "view-btn" onclick="get_row_rob(this)">VIEW</button>`;
          } else if (i == 1) {
            if (file[i] == "Youtube") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-yt-logo" src="youtube.png" alt="" />${file[i]}</div>`;
            } else if (file[i] == "Reddit") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-r-logo" src="reddit.png" alt="" />${file[i]}</div>`;
            } else if (file[i] == "Twitter") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-t-logo" src="twitter.png" alt="" />${file[i]}</div>`;
            } else if (file[i] == "Amazon") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-a-logo" src="amazon.png" alt="" />${file[i]}</div>`;
            }
          } else {
            info.innerHTML = `${file[i]}`;
          }
          row.appendChild(info);
        }
      }
      get_data_vad();
    }

    async function get_data_vad() {
      data = await eel.get_files()();
      table_body = document.getElementById("data-body2");

      for (const key of data[1]) {
        file = key.split(",");
        row = document.createElement("tr");
        table_body.appendChild(row);

        for (let i = 0; i < file.length + 2; i++) {
          info = document.createElement("td");
          if (i == 3) {
            info.innerHTML = `${file[i].slice(0, -4).replaceAll(".", ":")}`;
          } else if (i == 2) {
            info.innerHTML = `${file[i].replaceAll(".", "/")}`;
          } else if (i == 5) {
            info.innerHTML = `<button class = "del-btn" onclick="delete_row_vad(this)">DELETE</button>`;
          } else if (i == 4) {
            info.innerHTML = `<button class = "view-btn" onclick="get_row_vad(this)">VIEW</button>`;
          } else if (i == 1) {
            if (file[i] == "Youtube") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-yt-logo" src="youtube.png" alt="" />${file[i]}</div>`;
            } else if (file[i] == "Reddit") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-r-logo" src="reddit.png" alt="" />${file[i]}</div>`;
            } else if (file[i] == "Twitter") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-t-logo" src="twitter.png" alt="" />${file[i]}</div>`;
            } else if (file[i] == "Amazon") {
              info.innerHTML = `<div class="s-logo-box"><img class="s-a-logo" src="amazon.png" alt="" />${file[i]}</div>`;
            }
          } else {
            info.innerHTML = `${file[i]}`;
          }
          row.appendChild(info);
        }
      }
    }
  </script>
</html>
